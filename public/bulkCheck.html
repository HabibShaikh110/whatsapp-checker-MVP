<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="shortcut icon" href="/images/5SSdze-LogoMakr.png" type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsValid | App</title>
    <style>
       * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f4f4f4;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        align-items: center;
      }

      .navbar {
        background-color: #25d366;
        padding: 15px 30px;
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
      }

      .navbar .logo {
        font-size: 20px;
        font-weight: bold;
      }

      .navbar a {
        color: white;
        text-decoration: none;
        font-size: 14px;
      }

      h3 {
        text-align: center;
        margin-bottom: 20px;
      }
      

      #bulkForm {
        background: white;
        margin-top: 60px;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
        width: 90%;
        max-width: 600px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      input[type='file'] {
        margin-bottom: 20px;
        font-size: 14px;
      }

      #bulkForm button {
        padding: 10px 18px;
        background-color: #25d366;
        color: white;
        border: none;
        border-radius: 6px;
        font-weight: bold;
        cursor: pointer;
      }

      #bulkForm button:hover {
        background-color: #1db954;
      }

      #checkingBulkStatus {
        margin-top: 15px;
        font-size: 14px;
      }

      #bulk-result-section {
        margin-top: 40px;
        width: 90%;
        max-width: 700px;
        text-align: center;
      }

      #result-table {
        width: 100%;
        border-collapse: collapse;
        margin: 1rem 0;
        font-size: 16px;
        border: 1px solid #ccc;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.05);
      }

      #result-table th,
      #result-table td {
        border: 1px solid #ddd;
        padding: 10px 12px;
        text-align: center;
      }

      #result-table th {
        background-color: #f4f4f4;
        font-weight: 600;
      }

      #result-table tr:nth-child(even) {
        background-color: #fafafa;
      }

      #result-table tr:hover {
        background-color: #f1f7ff;
      }

      #bulk-result-section button {
        margin-top: 10px;
        padding: 10px 16px;
        background-color: royalblue;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 6px;
        font-weight: bold;
      }

      #bulk-result-section button:hover {
        background-color: #2b5cb8;
      }

      .footer {
        background-color: #fafafa;
        text-align: center;
        padding: 15px;
        font-size: 14px;
        color: #777;
        margin-top: auto;
        width: 100%;
      }
    </style>
</head>
<body>
    <div class="navbar">
        <div class="logo">WhatsValid</div>
          <a href="/index.html">Switch to Single Check</a>
        <a href="https://wa.bnbcloudservices.com">‚Üê Back to Main Site</a>
      </div>

    <form id="bulkForm">
        <h3>üìÇ Bulk Check (.txt or .csv)</h3>
        <input type="file" id="fileInput" />
        <button type="submit">Upload</button>
        <div id="checkingBulkStatus" style="display: none">
          ‚è≥Checking Numbers...
        </div>
        <div id="bulkResults"></div>
      </form>
      <!-- Result Table -->
      <div id="bulk-result-section" style="display: none; margin-top: 20px">
        <h3>‚úÖ Bulk Check Results:</h3>
        <table border="1" id="result-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Phone Number</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <button onclick="downloadExcel()">‚¨áÔ∏è Download Excel</button>
      </div>
    </div>
    <div class="footer">
      <p>Powererd By Testing Item</p>
    </div>
    <script>
        document
        .getElementById("bulkForm").addEventListener("submit", async function (e) {
        e.preventDefault();
          document.getElementById("checkingBulkStatus").style.display = "block";
          const fileInput = document.getElementById("fileInput");
          const file = fileInput.files[0];
          if (!file) return alert("Please select a file.");

          const formData = new FormData();
          formData.append("file", file);

          const res = await fetch("/upload", {
            method: "POST",
            body: formData,
          });

          const data = await res.json();
          const tableBody = document.querySelector("#result-table tbody");
          tableBody.innerHTML = "";

          if (data.results) {
            data.results.forEach((item, index) => {
              const row = document.createElement("tr");
              row.innerHTML = `
        <td>${index + 1}</td>
        <td>${item.number}</td>
        <td>${
          item.exists === true
            ? "‚úÖ Valid"
            : item.exists === false
            ? "‚ùå Invalid"
            : "‚ö†Ô∏è Error"
        }</td>
      `;
              tableBody.appendChild(row);
              document.getElementById("checkingBulkStatus").style.display =
                "none";
                
            });


            // üîê Save results for download
            window.bulkResults = data.results;
            console.log("üîç Bulk results stored:", window.bulkResults);
            document.getElementById("bulk-result-section").style.display =
              "block";
          } else {
            alert("No results found.");
          }
        });

      function downloadExcel() {
        if (!window.bulkResults || window.bulkResults.length === 0) {
          alert("No bulk results to download.");
          return;
        }

        const rows = [
          ["#", "Phone Number", "Status"],
          ...window.bulkResults.map((item, index) => [
            index + 1,
            `="${item.number}"`, // ‚úÖ Wrap number to preserve formatting
            item.exists === true
              ? "Valid"
              : item.exists === false
              ? "Invalid"
              : "Error",
          ]),
        ];

        const csvContent =
          "\uFEFF" +
          rows
            .map((row) =>
              row
                .map(String) // convert each item to string
                .map((cell) => `"${cell.replace(/"/g, '""')}"`) // escape double quotes
                .join(",")
            )
            .join("\r\n");

        const blob = new Blob([csvContent], {
          type: "text/csv;charset=utf-8;",
        });
        const link = document.createElement("a");
        const url = URL.createObjectURL(blob);
        link.setAttribute("href", url);
        link.setAttribute("download", "bulk-results.csv");
        link.style.visibility = "hidden";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }
    </script>
</body>
</html>