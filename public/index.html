<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="shortcut icon" href="/images/5SSdze-LogoMakr.png" type="image/x-icon">
    <meta charset="UTF-8" />
    <title>WhatsValid | App</title>
    <style>
      * {
        box-sizing: border-box;
      }
  
      body {
        margin: 0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f4f4f4;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }
  
      .navbar {
        background-color: #25d366;
        padding: 15px 30px;
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
  
      .navbar .logo {
        font-size: 20px;
        font-weight: bold;
      }
  
      .navbar a {
        color: white;
        text-decoration: none;
        font-size: 14px;
      }
      .nav-switch {
  position: absolute;
  top: 20px;
  right: 20px;
}

  
      .wrapper {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 40px 20px;
      }
  
      .main {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        width: 100%;
        max-width: 420px;
      }
  
      .main h1 {
        color: #25d366;
        text-align: center;
        margin-bottom: 10px;
      }
  
      .main h2 {
        color: #555;
        text-align: center;
        font-size: 14px;
        margin-bottom: 30px;
      }
  
      .main h3 {
        margin-bottom: 15px;
        color: #333;
        font-size: 18px;
      }
  
      input#numberInput {
        width: 100%;
        padding: 12px;
        border: 1px solid #ccc;
        border-radius: 8px;
        margin-bottom: 15px;
        font-size: 16px;
      }
  
      button {
        width: 100%;
        padding: 12px;
        background-color: #25d366;
        border: none;
        color: white;
        font-size: 16px;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }
  
      button:hover {
        background-color: #1ebe5d;
      }
  
      #checkingStatus {
        margin-top: 15px;
        color: #ff9900;
        font-weight: 500;
      }
  
      #results {
        margin-top: 15px;
        padding: 12px;
        border-radius: 6px;
        background-color: #f0f0f0;
        color: #333;
      }
  
      .footer {
        background-color: #fafafa;
        text-align: center;
        padding: 15px;
        font-size: 14px;
        color: #777;
      }
    </style>
  </head>
  <body>
  
    <!-- Navbar -->
    <div class="navbar">
      <div class="logo">WhatsValid</div>
        <a href="/bulkCheck.html">Switch to Bulk Check</a>
      <a href="https://wa.bnbcloudservices.com">‚Üê Back to Main Site</a>
    </div>
  
    <!-- Content -->
    <div class="wrapper">
      <div class="main">
        <p id="planName" style="font-weight: bold; margin-bottom: 10px;"></p>
        <h1>üì± WhatsApp Checker</h1>
        <h2>Fast & Simple - Just Enter the Number</h2>
  
        <h3>‚úÖ Enter WhatsApp Number</h3>
      
        <input
          id="numberInput"
          placeholder="Like 92333XXXXXXX"
        />
        <button onclick="checkSingle()">Check Now</button>
  
        <div id="checkingStatus" style="display: none;">
          ‚è≥ Checking Number...
        </div>
  
        <div id="results"></div>
      </div>
    </div>
  
    <!-- Footer -->
    <div class="footer">
      ¬© 2025 HUR Digital Creations ‚Äî All rights reserved.
    </div>

    <script>
      // Detect selected plan from URL
const urlParams = new URLSearchParams(window.location.search);
const plan = urlParams.get('plan');

// Show plan in UI (for now, just to see it works)
if (plan) {
  const planEl = document.getElementById('planName');
  if (planEl) {
    planEl.innerText = `üöÄ Selected Plan: ${plan.toUpperCase()}`;
  }
}

      // async function pollStatus() {
      //   const statusRes = await fetch("/status");
      //   const { connectionStatus } = await statusRes.json();
      //   const statusEl = document.getElementById("status");
      //   const qrBox = document.getElementById("qrBox");
      //   const qrImg = document.getElementById("qrImage");

      //   if (connectionStatus === "connected") {
      //     statusEl.innerText = "‚úÖ WhatsApp is Connected!";
      //     qrBox.style.display = "none";
      //   } else if (connectionStatus === "disconnected") {
      //     statusEl.innerText = "‚ùå Not connected. Scan QR below to connect:";
      //     const qrRes = await fetch("/qr");
      //     if (qrRes.status === 200) {
      //       const { qr } = await qrRes.json();
      //       qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?data=${encodeURIComponent(
      //         qr
      //       )}&size=200x200`;
      //       qrBox.style.display = "block";
      //     }
      //   } else {
      //     statusEl.innerText = "üîÑ Loading...";
      //   }
      // }
  


      // setInterval(pollStatus, 3000);
      // pollStatus();
      results.forEach(r => {
  let message;
  if (r.error) {
    message = r.error; // Show "Daily limit reached." instead of blank
  } else if (r.exists) {
    message = "‚úÖ On WhatsApp";
  } else {
    message = "‚ùå Not on WhatsApp";
  }

  // Example for adding to results list
  const li = document.createElement("li");
  li.textContent = `${r.number}: ${message}`;
  document.querySelector("#resultsList").appendChild(li);
});

      async function checkSingle() {
        document.getElementById("checkingStatus").style.display = "block";
        const number = document.getElementById("numberInput").value;
        const res = await fetch("/check", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ number }),
        });
        if (res.status === 429) {
  alert("Daily limit reached. Please try again tomorrow or upgrade your plan.");
  return;
}
        const data = await res.json();
        document.getElementById("results").innerText = data.exists
          ? `‚úÖ ${data.number} is on WhatsApp`
          : `‚ùå ${data.number} is NOT on WhatsApp`;
        document.getElementById("checkingStatus").style.display = "none";
      }

      document
        .getElementById("bulkForm").addEventListener("submit", async function (e) {
        e.preventDefault();
          document.getElementById("checkingBulkStatus").style.display = "block";

          const fileInput = document.getElementById("fileInput");
          const file = fileInput.files[0];
          if (!file) return alert("Please select a file.");

          const formData = new FormData();
          formData.append("file", file);

          const res = await fetch("/upload", {
            method: "POST",
            body: formData,
          });

          const data = await res.json();
          const tableBody = document.querySelector("#result-table tbody");
          tableBody.innerHTML = "";

          if (data.results) {
            data.results.forEach((item, index) => {
              const row = document.createElement("tr");
              row.innerHTML = `
        <td>${index + 1}</td>
        <td>${item.number}</td>
        <td>${
          item.exists === true
            ? "‚úÖ Valid"
            : item.exists === false
            ? "‚ùå Invalid"
            : "‚ö†Ô∏è Error"
        }</td>
      `;
              tableBody.appendChild(row);
              document.getElementById("checkingBulkStatus").style.display =
                "none";
                
            });


            // üîê Save results for download
            window.bulkResults = data.results;
            console.log("üîç Bulk results stored:", window.bulkResults);
            document.getElementById("bulk-result-section").style.display =
              "block";
          } else {
            alert("No results found.");
          }
        });

      function downloadExcel() {
        if (!window.bulkResults || window.bulkResults.length === 0) {
          alert("No bulk results to download.");
          return;
        }

        const rows = [
          ["#", "Phone Number", "Status"],
          ...window.bulkResults.map((item, index) => [
            index + 1,
            `="${item.number}"`, // ‚úÖ Wrap number to preserve formatting
            item.exists === true
              ? "Valid"
              : item.exists === false
              ? "Invalid"
              : "Error",
          ]),
        ];

        const csvContent =
          "\uFEFF" +
          rows
            .map((row) =>
              row
                .map(String) // convert each item to string
                .map((cell) => `"${cell.replace(/"/g, '""')}"`) // escape double quotes
                .join(",")
            )
            .join("\r\n");

        const blob = new Blob([csvContent], {
          type: "text/csv;charset=utf-8;",
        });
        const link = document.createElement("a");
        const url = URL.createObjectURL(blob);
        link.setAttribute("href", url);
        link.setAttribute("download", "bulk-results.csv");
        link.style.visibility = "hidden";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }
      
    </script>
  </body>
</html>
